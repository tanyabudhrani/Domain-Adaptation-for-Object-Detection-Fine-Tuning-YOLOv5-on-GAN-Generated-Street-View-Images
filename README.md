# Domain Adaptation for Object Detection: Fine-Tuning YOLOv5 on GAN-Generated Street View Images
**By Tanya Budhrani & LEE Ka Chun, Caius**

This project explores a dual-pipeline approach in computer vision, combining **image-to-image translation using GANs** and **object detection using YOLOv5**. It investigates how domain adaptation techniques such as **fine-tuning** and **test-time augmentation (TTA)** can improve YOLOv5 performance when detecting objects in synthetically generated images.

---

## üîç Project Overview

The project is divided into two parts:

- **Part 1 (by Caius):** Build and train a GAN to generate photorealistic urban scenes from semantic segmentation maps.
- **Part 2 (by Tanya):** Apply and adapt YOLOv5 to detect objects in the GAN-generated images through:
  - Test-Time Augmentation (TTA)
  - Manual annotation via LabelImg
  - Fine-tuning on a custom synthetic dataset
  - Performance evaluation and comparison


## üìÇ Repository Structure

```

.
‚îú‚îÄ‚îÄ generated\_images/           # GAN-generated synthetic street views
‚îú‚îÄ‚îÄ labelled\_images/            # Raw YOLO-formatted annotations
‚îú‚îÄ‚îÄ fine\_tune\_data/             # Training/validation split images & labels
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îî‚îÄ‚îÄ labels/
‚îú‚îÄ‚îÄ generated.yaml              # Dataset configuration file for YOLOv5
‚îú‚îÄ‚îÄ fps.py                      # Script to measure model inference speed
‚îú‚îÄ‚îÄ runs/                       # Auto-generated by YOLOv5 (detect + train outputs)
‚îî‚îÄ‚îÄ README.md

````

---

## How to Run

### 1. Clone YOLOv5 Repo
```bash
git clone https://github.com/ultralytics/yolov5
cd yolov5
pip install -r requirements.txt
````

### 2. Inference on Synthetic Images

```bash
python detect.py --weights yolov5s.pt --source ../generated_images --conf 0.25
```

### 3. Test-Time Augmentation

```bash
python detect.py --weights yolov5s.pt --source ../generated_images --conf 0.25 --augment
```

### 4. Fine-Tune on Custom Dataset

```bash
python train.py --img 416 --batch 8 --epochs 50 \
--data ../generated.yaml \
--weights yolov5s.pt \
--name retrained_balanced --cache --optimizer Adam
```

---

## Evaluation Metrics

| Metric            | Description                                              |
| ----------------- | -------------------------------------------------------- |
| **Precision**     | How accurate predictions are (avoiding false positives)  |
| **Recall**        | How complete predictions are (avoiding false negatives)  |
| **mAP\@0.5**      | Accuracy at 50% IoU threshold                            |
| **mAP\@0.5:0.95** | Average accuracy over stricter IoU thresholds (0.5‚Äì0.95) |
| **FPS**           | Frames per second (inference speed)                      |

---

## Key Findings

* **Initial inference** using the pretrained YOLOv5s resulted in low confidence predictions and misclassifications (e.g., umbrellas, kites).
* **TTA** improved detection confidence but not class diversity.
* **Manual annotation** via LabelImg was used to create training labels across 10 object categories.
* **Fine-tuning with a reduced label set** (Road, Tree, Pole, House, Traffic Light) improved mAP and reduced false positives.
* **Post-fine-tuning**, FPS increased from **2.93 to 13.51**, and mAP\@0.5 improved to **0.362** for well-represented classes like Tree and Road.

---

## Lessons & Next Steps

* Fine-tuning pretrained models can significantly improve performance on domain-shifted data.
* Label quality and class balance are critical.
* Future work may include:

  * More annotated images
  * Better bounding box consistency
  * Advanced augmentations (CutMix, Style Transfer)

---

## References

* [Ultralytics YOLOv5](https://github.com/ultralytics/yolov5)
* [CutMix: Regularization Strategy](https://arxiv.org/abs/1905.04899)
* [YOLO Data Augmentation](https://docs.ultralytics.com/guides/yolo-data-augmentation/)
* [Improving Synthetic Image Detection](https://arxiv.org/abs/2408.06741)
* [Accuracy vs. Precision vs. Recall](https://www.evidentlyai.com/classification-metrics/accuracy-precision-recall)


